<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D.M. MALIWANAG BUILDERS AND ENTERPRISES - Equipment Payroll</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    header { text-align: center; margin-bottom: 20px; }
    header h1 { margin: 0; font-size: 28px; font-weight: bold; }
    header h2 { margin: 0; font-size: 20px; font-weight: normal; color: #555; }

    nav { text-align: center; margin-bottom: 20px; }
    nav button {
      margin: 0 5px;
      padding: 8px 16px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    nav button:hover { background: #0056b3; }

    .section { display: none; }
    .active { display: block; }

    .controls { margin: 15px 0; text-align: center; }
    input, select, button { padding: 6px 10px; margin: 5px; font-size: 14px; }
    button { background: #007bff; color: #fff; border: none; cursor: pointer; border-radius: 4px; }
    button:hover { background: #0056b3; }
    .delete-btn { background: red; color: #fff; padding: 5px 10px; border-radius: 4px; }

    table { width: 100%; border-collapse: collapse; background: #fff; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #333; color: #fff; }

    .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
    .card {
      background: #fff; padding: 20px; border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center;
    }
    .card h3 { margin: 0; font-size: 16px; color: #555; }
    .card p { font-size: 22px; font-weight: bold; margin: 10px 0 0; }
  </style>
</head>
<body>
  <header>
    <h1>D.M. MALIWANAG BUILDERS AND ENTERPRISES</h1>
    <h2>Equipment Payroll System</h2>
  </header>

  <nav>
    <button onclick="showSection('equipmentSection')">Equipment</button>
    <button onclick="showSection('payrollSection')">Payroll</button>
    <button onclick="showSection('dashboardSection')">Dashboard</button>
  </nav>

  <!-- Equipment Section -->
  <div id="equipmentSection" class="section active">
    <h2 style="text-align:center;">Equipment Management</h2>
    <div class="controls">
      <input type="text" id="eqName" placeholder="Equipment Name">
      <input type="text" id="eqType" placeholder="Type">
      <input type="number" id="eqRate" placeholder="Rate/Day">
      <input type="text" id="eqDriver" placeholder="Driver Name">
      <input type="number" id="eqDriverDays" placeholder="Driver Days Worked">
      <input type="text" id="eqHelper" placeholder="Helper Name">
      <input type="number" id="eqHelperDays" placeholder="Helper Days Worked">
      <select id="eqStatus">
        <option value="Available">Available</option>
        <option value="In Use">In Use</option>
        <option value="Under Repair">Under Repair</option>
      </select>
      <button onclick="addEquipment()">Add Equipment</button>
    </div>

    <table id="equipmentTable">
      <thead>
        <tr>
          <th>Equipment</th>
          <th>Type</th>
          <th>Rate/Day</th>
          <th>Driver</th>
          <th>Driver Days</th>
          <th>Helper</th>
          <th>Helper Days</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Payroll Section -->
  <div id="payrollSection" class="section">
    <h2 style="text-align:center;">Equipment Payroll</h2>
    <table id="payrollTable">
      <thead>
        <tr>
          <th>Equipment</th>
          <th>Name</th>
          <th>Role</th>
          <th>Rate/Day</th>
          <th>Days Worked</th>
          <th>Total Pay</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div style="text-align:center; margin-top:15px;">
      <button onclick="printPayroll()">Print Payroll</button>
    </div>
  </div>

  <!-- Dashboard Section -->
  <div id="dashboardSection" class="section">
    <h2 style="text-align:center;">Equipment Dashboard</h2>
    <div class="dashboard">
      <div class="card"><h3>Total Equipments</h3><p id="totalEquipments">0</p></div>
      <div class="card"><h3>Available</h3><p id="availableEquipments">0</p></div>
      <div class="card"><h3>In Use</h3><p id="inUseEquipments">0</p></div>
      <div class="card"><h3>Under Repair</h3><p id="repairEquipments">0</p></div>
      <div class="card"><h3>Total Drivers</h3><p id="totalDrivers">0</p></div>
      <div class="card"><h3>Total Helpers</h3><p id="totalHelpers">0</p></div>
      <div class="card"><h3>Total Payroll</h3><p id="totalPayroll">₱0</p></div>
    </div>

    <h3 style="text-align:center;">Recent Equipment</h3>
    <table>
      <thead>
        <tr>
          <th>Equipment</th>
          <th>Type</th>
          <th>Driver</th>
          <th>Helper</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="recentEquipments"></tbody>
    </table>
  </div>

  <script>
    let equipmentList = JSON.parse(localStorage.getItem("equipmentList")) || [];

    function saveData() {
      localStorage.setItem("equipmentList", JSON.stringify(equipmentList));
    }

    function renderAll() {
      renderEquipment();
      renderPayroll();
      updateDashboard();
    }

    function renderEquipment() {
      const tableBody = document.querySelector("#equipmentTable tbody");
      tableBody.innerHTML = "";
      equipmentList.forEach((item, index) => {
        const row = tableBody.insertRow();
        row.insertCell(0).innerText = item.name;
        row.insertCell(1).innerText = item.type;
        row.insertCell(2).innerText = item.rate;
        row.insertCell(3).innerText = item.driver;
        row.insertCell(4).innerText = item.driverDays;
        row.insertCell(5).innerText = item.helper;
        row.insertCell(6).innerText = item.helperDays;
        row.insertCell(7).innerText = item.status;
        const actionCell = row.insertCell(8);
        const delBtn = document.createElement("button");
        delBtn.innerText = "Delete";
        delBtn.className = "delete-btn";
        delBtn.onclick = function () {
          equipmentList.splice(index, 1);
          saveData();
          renderAll();
        };
        actionCell.appendChild(delBtn);
      });
    }

    function renderPayroll() {
      const payrollBody = document.querySelector("#payrollTable tbody");
      payrollBody.innerHTML = "";

      equipmentList.forEach(item => {
        if (item.driver) {
          const dRow = payrollBody.insertRow();
          dRow.insertCell(0).innerText = item.name;
          dRow.insertCell(1).innerText = item.driver;
          dRow.insertCell(2).innerText = "Driver";
          dRow.insertCell(3).innerText = item.rate;
          dRow.insertCell(4).innerText = item.driverDays;
          dRow.insertCell(5).innerText = item.driverDays * item.rate;
        }
        if (item.helper) {
          const hRow = payrollBody.insertRow();
          hRow.insertCell(0).innerText = item.name;
          hRow.insertCell(1).innerText = item.helper;
          hRow.insertCell(2).innerText = "Helper";
          hRow.insertCell(3).innerText = item.rate;
          hRow.insertCell(4).innerText = item.helperDays;
          hRow.insertCell(5).innerText = item.helperDays * item.rate;
        }
      });
    }

    function updateDashboard() {
      let total = equipmentList.length;
      let available = equipmentList.filter(e => e.status === "Available").length;
      let inUse = equipmentList.filter(e => e.status === "In Use").length;
      let repair = equipmentList.filter(e => e.status === "Under Repair").length;
      let drivers = equipmentList.filter(e => e.driver).length;
      let helpers = equipmentList.filter(e => e.helper).length;
      let totalPayroll = 0;
      equipmentList.forEach(e => {
        if (e.driverDays) totalPayroll += e.driverDays * e.rate;
        if (e.helperDays) totalPayroll += e.helperDays * e.rate;
      });

      document.getElementById("totalEquipments").innerText = total;
      document.getElementById("availableEquipments").innerText = available;
      document.getElementById("inUseEquipments").innerText = inUse;
      document.getElementById("repairEquipments").innerText = repair;
      document.getElementById("totalDrivers").innerText = drivers;
      document.getElementById("totalHelpers").innerText = helpers;
      document.getElementById("totalPayroll").innerText = "₱" + totalPayroll.toLocaleString();

      const recentTable = document.getElementById("recentEquipments");
      recentTable.innerHTML = "";
      equipmentList.slice(-5).forEach(e => {
        let row = recentTable.insertRow();
        row.insertCell(0).innerText = e.name;
        row.insertCell(1).innerText = e.type;
        row.insertCell(2).innerText = e.driver || "-";
        row.insertCell(3).innerText = e.helper || "-";
        row.insertCell(4).innerText = e.status;
      });
    }

    function addEquipment() {
      const name = document.getElementById("eqName").value.trim();
      const type = document.getElementById("eqType").value.trim();
      const rate = parseFloat(document.getElementById("eqRate").value.trim());
      const driver = document.getElementById("eqDriver").value.trim();
      const driverDays = parseInt(document.getElementById("eqDriverDays").value.trim()) || 0;
      const helper = document.getElementById("eqHelper").value.trim();
      const helperDays = parseInt(document.getElementById("eqHelperDays").value.trim()) || 0;
      const status = document.getElementById("eqStatus").value;

      if (!name || !type || !rate) {
        alert("Please fill out required fields.");
        return;
      }

      equipmentList.push({ name, type, rate, driver, driverDays, helper, helperDays, status });
      saveData();
      renderAll();

      document.querySelectorAll(".controls input").forEach(el => el.value = "");
    }

    function printPayroll() {
      const printContents = document.querySelector("#payrollTable").outerHTML;
      const w = window.open("", "", "width=900,height=650");
      w.document.write(`
        <html>
          <head><title>Equipment Payroll</title></head>
          <body>
            <h2 style="text-align:center;">D.M. MALIWANAG BUILDERS AND ENTERPRISES</h2>
            <h3 style="text-align:center;">Equipment Payroll</h3>
            <p style="text-align:center;"><b>Payroll Period:</b> _____________________</p>
            ${printContents}
            <br><br>
            <table style="width:100%; margin-top:40px; text-align:center;">
              <tr>
                <td><b>Prepared by:</b><br><br>___________________</td>
                <td><b>Checked by:</b><br><br>___________________</td>
                <td><b>Approved by:</b><br><br>___________________</td>
              </tr>
            </table>
          </body>
        </html>
      `);
      w.document.close();
      w.print();
    }

    function showSection(id) {
      document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    window.onload = renderAll;
  </script>
</body>
</html>
